"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.compilerHostSourceGetter = void 0;
var typescript_1 = require("typescript");
var fs_1 = require("fs");
var sourceFiles = {};
// Try find d.ts source in typescript folder
function getDtsSourceFile(name, target) {
    if (sourceFiles[name] === undefined) {
        var path = void 0;
        try {
            path = name.startsWith('/') ? name : require.resolve('typescript/lib/' + name);
        }
        catch (e) {
            path = require.resolve(name.replace(/^node_modules\//, ''));
        }
        if (fs_1.existsSync(path)) {
            var input = fs_1.readFileSync(path, { encoding: 'utf-8' });
            sourceFiles[name] = typescript_1.createSourceFile(name, input, target);
        }
        else {
            sourceFiles[name] = null;
        }
    }
    return sourceFiles[name];
}
function getSourceFile(path, target) {
    if (sourceFiles[path] === undefined) {
        if (fs_1.existsSync(path)) {
            var input = fs_1.readFileSync(path, { encoding: 'utf-8' });
            sourceFiles[path] = typescript_1.createSourceFile(path, input, target);
        }
        else {
            sourceFiles[path] = null;
        }
    }
    return sourceFiles[path];
}
var compilerHostSourceGetter = function (scriptTarget) { return function (fileName) {
    if (fileName.endsWith('.d.ts')) {
        return getDtsSourceFile(fileName, scriptTarget) || undefined;
    }
    return getSourceFile(fileName, scriptTarget) || undefined;
}; };
exports.compilerHostSourceGetter = compilerHostSourceGetter;
